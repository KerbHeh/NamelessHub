local Fluent = loadstring(game:HttpGet("https://github.com/dawid-scripts/Fluent/releases/latest/download/main.lua"))()
local SaveManager = loadstring(game:HttpGet("https://raw.githubusercontent.com/dawid-scripts/Fluent/master/Addons/SaveManager.lua"))()
local InterfaceManager = loadstring(game:HttpGet("https://raw.githubusercontent.com/dawid-scripts/Fluent/master/Addons/InterfaceManager.lua"))()

local Players    = game:GetService("Players")
local RunService = game:GetService("RunService")
local UserInput  = game:GetService("UserInputService")
local Lighting   = game:GetService("Lighting")
local VirtualUser= game:GetService("VirtualUser")
local LP         = Players.LocalPlayer

-- ──────────────────────────────────────────
--  JANELA  (Acrylic OFF = mais compatível)
-- ──────────────────────────────────────────
local Window = Fluent:CreateWindow({
    Title       = "Brookhaven Admin HD",
    SubTitle    = "v4 — FE Safe",
    TabWidth    = 160,
    Size        = UDim2.fromOffset(640, 520),
    Acrylic     = false,   -- ← CORRIGIDO
    Theme       = "Dark",
    MinimizeKey = Enum.KeyCode.RightControl,
})

local Tabs = {
    Move   = Window:AddTab({ Title = "Movimento", Icon = "zap"      }),
    Player = Window:AddTab({ Title = "Jogador",   Icon = "user"     }),
    Visual = Window:AddTab({ Title = "Visual",    Icon = "eye"      }),
    World  = Window:AddTab({ Title = "Mundo",     Icon = "globe"    }),
    Misc   = Window:AddTab({ Title = "Misc",      Icon = "star"     }),
    Config = Window:AddTab({ Title = "Config",    Icon = "settings" }),
}

local Options = Fluent.Options

-- ──────────────────────────────────────────
--  UTILITÁRIOS
-- ──────────────────────────────────────────
local C = {}
local function conn(k, sig, fn) if C[k] then C[k]:Disconnect() end; C[k] = sig:Connect(fn) end
local function dconn(k) if C[k] then C[k]:Disconnect(); C[k] = nil end end
local function getChar() return LP.Character end
local function getRoot() local c=getChar() return c and c:FindFirstChild("HumanoidRootPart") end
local function getHum()  local c=getChar() return c and c:FindFirstChildOfClass("Humanoid") end

local function notify(t, msg, dur)
    Fluent:Notify({ Title=t, Content=msg, Duration=dur or 4 })
end

local SCALE = {"BodyHeightScale","BodyDepthScale","BodyWidthScale","HeadScale"}
local function applyScale(s)
    local h = getHum(); if not h then return end
    for _, n in ipairs(SCALE) do
        local v = h:FindFirstChild(n); if v then v.Value = s end
    end
end

local ORIG = {
    Brightness    = Lighting.Brightness,
    ClockTime     = Lighting.ClockTime,
    FogEnd        = Lighting.FogEnd,
    GlobalShadows = Lighting.GlobalShadows,
    Ambient       = Lighting.Ambient,
}

LP.CharacterAdded:Connect(function()
    task.wait(1.5)
    local h = getHum(); if not h then return end
    if Options.WalkSpeed then h.WalkSpeed  = Options.WalkSpeed.Value end
    if Options.JumpPower then
        h.JumpPower  = Options.JumpPower.Value
        h.JumpHeight = Options.JumpPower.Value
    end
    if Options.SizeScale then applyScale(Options.SizeScale.Value) end
    if Options.GodMode and Options.GodMode.Value then
        conn("god", RunService.Heartbeat, function()
            local hm = getHum(); if hm then hm.Health = hm.MaxHealth end
        end)
    end
end)

-- ──────────────────────────────────────────
--  ABA MOVIMENTO
-- ──────────────────────────────────────────
Tabs.Move:AddParagraph({
    Title   = "Movimento",
    Content = "Sliders aplicam em tempo real. Sprint ativo = Shift dobra velocidade."
})

Tabs.Move:AddSlider("WalkSpeed", {
    Title = "Velocidade (WalkSpeed)", Description = "Padrão: 16",
    Default = 16, Min = 0, Max = 500, Rounding = 0,
    Callback = function(v) local h=getHum() if h then h.WalkSpeed=v end end,
})

Tabs.Move:AddSlider("JumpPower", {
    Title = "Pulo (JumpPower)", Description = "Padrão: 50",
    Default = 50, Min = 0, Max = 500, Rounding = 0,
    Callback = function(v)
        local h=getHum()
        if h then h.JumpPower=v; h.JumpHeight=v end
    end,
})

Tabs.Move:AddSlider("SizeScale", {
    Title = "Tamanho (Scale)", Description = "1 = normal | 0.1 = micro | 5 = gigante",
    Default = 1, Min = 0.1, Max = 5, Rounding = 2,
    Callback = function(v) applyScale(v) end,
})

Tabs.Move:AddToggle("Sprint", {
    Title = "Sprint (Shift)", Description = "Shift = 2.5× velocidade configurada",
    Default = false,
    Callback = function(v)
        dconn("sprint")
        if not v then local h=getHum() if h then h.WalkSpeed=Options.WalkSpeed.Value end; return end
        conn("sprint", RunService.Heartbeat, function()
            local h=getHum(); if not h then return end
            h.WalkSpeed = Options.WalkSpeed.Value * (UserInput:IsKeyDown(Enum.KeyCode.LeftShift) and 2.5 or 1)
        end)
    end,
})

-- Fly
local flySpeed = 50
local flyActive = false

Tabs.Move:AddToggle("Fly", {
    Title = "Voar (Fly)", Description = "WASD = direção  |  Espaço = subir  |  Ctrl = descer",
    Default = false,
    Callback = function(v)
        flyActive = v
        local root = getRoot(); if not root then return end

        if not v then
            dconn("fly")
            for _, obj in ipairs(root:GetChildren()) do
                if obj:IsA("BodyVelocity") or obj:IsA("BodyGyro") then obj:Destroy() end
            end
            return
        end

        local bv = Instance.new("BodyVelocity")
        bv.MaxForce = Vector3.new(1e5,1e5,1e5)
        bv.Velocity = Vector3.zero
        bv.Parent   = root

        local bg = Instance.new("BodyGyro")
        bg.MaxTorque = Vector3.new(1e5,1e5,1e5)
        bg.D = 50
        bg.Parent = root

        local cam = workspace.CurrentCamera
        conn("fly", RunService.Heartbeat, function()
            if not flyActive then return end
            root = getRoot(); if not root then return end
            local dir = Vector3.zero
            if UserInput:IsKeyDown(Enum.KeyCode.W)           then dir += cam.CFrame.LookVector  end
            if UserInput:IsKeyDown(Enum.KeyCode.S)           then dir -= cam.CFrame.LookVector  end
            if UserInput:IsKeyDown(Enum.KeyCode.A)           then dir -= cam.CFrame.RightVector end
            if UserInput:IsKeyDown(Enum.KeyCode.D)           then dir += cam.CFrame.RightVector end
            if UserInput:IsKeyDown(Enum.KeyCode.Space)       then dir += Vector3.new(0,1,0)     end
            if UserInput:IsKeyDown(Enum.KeyCode.LeftControl) then dir -= Vector3.new(0,1,0)     end
            bv.Velocity = dir.Magnitude > 0 and dir.Unit * flySpeed or Vector3.zero
            bg.CFrame   = cam.CFrame
        end)
    end,
})

Tabs.Move:AddSlider("FlySpeed", {
    Title = "Velocidade do Voo", Description = "Padrão: 50",
    Default = 50, Min = 5, Max = 300, Rounding = 0,
    Callback = function(v) flySpeed = v end,
})

Tabs.Move:AddButton({
    Title = "Resetar Movimento",
    Callback = function()
        Options.WalkSpeed:SetValue(16)
        Options.JumpPower:SetValue(50)
        Options.SizeScale:SetValue(1)
        notify("Reset", "Movimento restaurado.")
    end,
})

-- ──────────────────────────────────────────
--  ABA JOGADOR
-- ──────────────────────────────────────────
Tabs.Player:AddToggle("GodMode", {
    Title = "God Mode", Description = "HP sempre no máximo",
    Default = false,
    Callback = function(v)
        dconn("god")
        if v then conn("god", RunService.Heartbeat, function()
            local h=getHum(); if h then h.Health=h.MaxHealth end
        end) end
    end,
})

Tabs.Player:AddToggle("Noclip", {
    Title = "Noclip", Description = "Atravessa paredes",
    Default = false,
    Callback = function(v)
        dconn("noclip")
        if v then
            conn("noclip", RunService.Stepped, function()
                local c=getChar(); if not c then return end
                for _,p in ipairs(c:GetDescendants()) do
                    if p:IsA("BasePart") then p.CanCollide=false end
                end
            end)
        else
            local c=getChar(); if not c then return end
            for _,p in ipairs(c:GetDescendants()) do
                if p:IsA("BasePart") then p.CanCollide=true end
            end
        end
    end,
})

Tabs.Player:AddToggle("AntiAFK", {
    Title = "Anti-AFK", Description = "Nunca toma kick por inatividade",
    Default = false,
    Callback = function(v)
        dconn("afk")
        if v then
            conn("afk", LP.Idled, function()
                VirtualUser:Button2Down(Vector2.new(0,0), workspace.CurrentCamera.CFrame)
                task.wait(0.1)
                VirtualUser:Button2Up(Vector2.new(0,0), workspace.CurrentCamera.CFrame)
            end)
        end
    end,
})

Tabs.Player:AddToggle("Invisible", {
    Title = "Invisibilidade (local)", Description = "Só você não se vê",
    Default = false,
    Callback = function(v)
        local c=getChar(); if not c then return end
        for _,p in ipairs(c:GetDescendants()) do
            if p:IsA("BasePart") then p.LocalTransparencyModifier = v and 1 or 0 end
        end
    end,
})

Tabs.Player:AddButton({
    Title = "Teleport → Spawn",
    Callback = function()
        local root=getRoot()
        local spawn=workspace:FindFirstChildOfClass("SpawnLocation")
        if root and spawn then
            root.CFrame = spawn.CFrame + Vector3.new(0,5,0)
            notify("Teleport", "Chegou no Spawn!")
        else
            notify("Erro", "Spawn não encontrado.")
        end
    end,
})

Tabs.Player:AddButton({
    Title = "Teleport → Cursor (clique no mapa)",
    Callback = function()
        notify("Modo Clique", "Clique no chão. ESC cancela.")
        local tmp
        tmp = UserInput.InputBegan:Connect(function(inp)
            if inp.UserInputType == Enum.UserInputType.MouseButton1 then
                local mouse = LP:GetMouse()
                local root  = getRoot()
                if root and mouse.Target then
                    root.CFrame = CFrame.new(mouse.Hit.Position + Vector3.new(0,5,0))
                    notify("Teleport", "Teleportado para o cursor!")
                end
                tmp:Disconnect()
            elseif inp.KeyCode == Enum.KeyCode.Escape then
                tmp:Disconnect()
                notify("Cancelado", "Teleport cancelado.")
            end
        end)
    end,
})

Tabs.Player:AddButton({
    Title = "Teleport → Jogador",
    Description = "Vai até o jogador mais próximo",
    Callback = function()
        local root = getRoot(); if not root then return end
        local closest, dist = nil, math.huge
        for _, p in ipairs(Players:GetPlayers()) do
            if p == LP then continue end
            local c = p.Character
            local r = c and c:FindFirstChild("HumanoidRootPart")
            if r then
                local d = (r.Position - root.Position).Magnitude
                if d < dist then dist=d; closest=p end
            end
        end
        if closest then
            local r = closest.Character.HumanoidRootPart
            root.CFrame = r.CFrame + Vector3.new(0,5,0)
            notify("Teleport", "Chegou em "..closest.Name.."!")
        else
            notify("Erro", "Nenhum jogador encontrado.")
        end
    end,
})

-- ──────────────────────────────────────────
--  ABA VISUAL
-- ──────────────────────────────────────────
Tabs.Visual:AddToggle("FullBright", {
    Title = "FullBright",
    Default = false,
    Callback = function(v)
        if v then
            Lighting.Brightness    = 10
            Lighting.ClockTime     = 14
            Lighting.FogEnd        = 1e9
            Lighting.GlobalShadows = false
            Lighting.Ambient       = Color3.fromRGB(255,255,255)
        else
            Lighting.Brightness    = ORIG.Brightness
            Lighting.ClockTime     = ORIG.ClockTime
            Lighting.FogEnd        = ORIG.FogEnd
            Lighting.GlobalShadows = ORIG.GlobalShadows
            Lighting.Ambient       = ORIG.Ambient
        end
    end,
})

Tabs.Visual:AddSlider("FOV", {
    Title = "FOV", Description = "Padrão: 70",
    Default = 70, Min = 30, Max = 120, Rounding = 0,
    Callback = function(v) workspace.CurrentCamera.FieldOfView = v end,
})

conn("camfov", workspace:GetPropertyChangedSignal("CurrentCamera"), function()
    task.wait()
    if Options.FOV then workspace.CurrentCamera.FieldOfView = Options.FOV.Value end
end)

-- ESP
local espBoards = {}

local function clearESP()
    for _,v in pairs(espBoards) do pcall(function() v:Destroy() end) end
    espBoards = {}
    for k in pairs(C) do if k:sub(1,4) == "esp_" then dconn(k) end end
end

local function buildESP()
    clearESP()
    for _, plr in ipairs(Players:GetPlayers()) do
        if plr == LP then continue end
        local function setup(char)
            if not char then return end
            task.wait(1)
            local root = char:FindFirstChild("HumanoidRootPart")
            if not root then return end

            local bb = Instance.new("BillboardGui")
            bb.Adornee     = root
            bb.AlwaysOnTop = true
            bb.Size        = UDim2.fromOffset(140, 50)
            bb.StudsOffset = Vector3.new(0,3.5,0)
            bb.Parent      = root

            local bg = Instance.new("Frame", bb)
            bg.BackgroundColor3 = Color3.fromRGB(15,15,15)
            bg.BackgroundTransparency = 0.35
            bg.BorderSizePixel = 0
            bg.Size = UDim2.fromScale(1,1)
            Instance.new("UICorner", bg).CornerRadius = UDim.new(0,6)

            local nameLbl = Instance.new("TextLabel", bg)
            nameLbl.Size = UDim2.new(1,0,0,22)
            nameLbl.Position = UDim2.fromOffset(0,4)
            nameLbl.BackgroundTransparency = 1
            nameLbl.TextColor3 = Color3.fromRGB(255,220,60)
            nameLbl.TextStrokeTransparency = 0.4
            nameLbl.TextScaled = true
            nameLbl.Font = Enum.Font.GothamBold
            nameLbl.Text = plr.DisplayName

            local hpLbl = Instance.new("TextLabel", bg)
            hpLbl.Size = UDim2.new(1,0,0,18)
            hpLbl.Position = UDim2.fromOffset(0,28)
            hpLbl.BackgroundTransparency = 1
            hpLbl.TextColor3 = Color3.fromRGB(100,255,100)
            hpLbl.TextStrokeTransparency = 0.4
            hpLbl.TextScaled = true
            hpLbl.Font = Enum.Font.Gotham
            hpLbl.Text = "❤ ..."

            conn("esp_"..plr.UserId, RunService.Heartbeat, function()
                local hum = char:FindFirstChildOfClass("Humanoid")
                if hum and hpLbl.Parent then
                    local pct = hum.Health / hum.MaxHealth
                    hpLbl.Text       = "❤ "..math.floor(hum.Health).."  ("..math.floor(pct*100).."%)"
                    hpLbl.TextColor3 = Color3.fromRGB(math.floor(255*(1-pct)), math.floor(255*pct), 50)
                end
            end)

            table.insert(espBoards, bb)
        end

        setup(plr.Character)
        plr.CharacterAdded:Connect(setup)
    end
end

Tabs.Visual:AddToggle("ESP", {
    Title = "ESP (Nome + HP colorido)",
    Default = false,
    Callback = function(v)
        if v then
            buildESP()
            conn("esp_add", Players.PlayerAdded, function(p)
                p.CharacterAdded:Connect(function() task.wait(1); buildESP() end)
            end)
            conn("esp_rem", Players.PlayerRemoving, function()
                task.wait(0.5); buildESP()
            end)
        else
            clearESP(); dconn("esp_add"); dconn("esp_rem")
        end
    end,
})

Tabs.Visual:AddToggle("Crosshair", {
    Title = "Crosshair",
    Default = false,
    Callback = function(v)
        local e = LP.PlayerGui:FindFirstChild("_CH")
        if e then e:Destroy() end
        if not v then return end
        local sg = Instance.new("ScreenGui", LP.PlayerGui)
        sg.Name="_CH"; sg.ResetOnSpawn=false; sg.IgnoreGuiInset=true
        local function bar(w,h,ox,oy)
            local f = Instance.new("Frame",sg)
            f.BackgroundColor3 = Color3.fromRGB(255,255,255)
            f.BorderSizePixel  = 0
            f.Size             = UDim2.fromOffset(w,h)
            f.Position         = UDim2.new(.5,ox-.5*w,.5,oy-.5*h)
        end
        bar(14,2,0,0); bar(2,14,0,0)
    end,
})

-- Tracers
Tabs.Visual:AddToggle("Tracers", {
    Title = "Tracers", Description = "Linha até cada jogador",
    Default = false,
    Callback = function(v)
        dconn("tracers")
        local sg = LP.PlayerGui:FindFirstChild("_TR")
        if sg then sg:Destroy() end
        if not v then return end

        local gui = Instance.new("ScreenGui", LP.PlayerGui)
        gui.Name="_TR"; gui.ResetOnSpawn=false; gui.IgnoreGuiInset=true

        conn("tracers", RunService.RenderStepped, function()
            for _,f in ipairs(gui:GetChildren()) do f:Destroy() end
            local cam  = workspace.CurrentCamera
            local vp   = cam.ViewportSize
            local orig = Vector2.new(vp.X/2, vp.Y)

            for _, plr in ipairs(Players:GetPlayers()) do
                if plr == LP then continue end
                local char = plr.Character
                local root = char and char:FindFirstChild("HumanoidRootPart")
                if not root then continue end

                local sp, onScreen = cam:WorldToViewportPoint(root.Position)
                if not onScreen then continue end

                local dest  = Vector2.new(sp.X, sp.Y)
                local delta = dest - orig
                local angle = math.atan2(delta.Y, delta.X)

                local line = Instance.new("Frame", gui)
                line.AnchorPoint      = Vector2.new(0, 0.5)
                line.BackgroundColor3 = Color3.fromRGB(255,60,60)
                line.BorderSizePixel  = 0
                line.Rotation         = math.deg(angle)
                line.Size             = UDim2.fromOffset(delta.Magnitude, 2)
                line.Position         = UDim2.fromOffset(orig.X, orig.Y)
            end
        end)
    end,
})

-- ──────────────────────────────────────────
--  ABA MUNDO
-- ──────────────────────────────────────────
Tabs.World:AddSlider("Gravity", {
    Title = "Gravidade", Description = "Padrão: 196",
    Default = 196, Min = 0, Max = 500, Rounding = 0,
    Callback = function(v) workspace.Gravity = v end,
})

Tabs.World:AddButton({ Title = "Clima: Normal",        Callback = function() Lighting.ClockTime=14;  Lighting.Brightness=2;   Lighting.FogEnd=1e6;  Lighting.Ambient=Color3.fromRGB(100,100,100) end })
Tabs.World:AddButton({ Title = "Clima: Noite Fechada", Callback = function() Lighting.ClockTime=0;   Lighting.Brightness=0;   Lighting.FogEnd=200;  Lighting.Ambient=Color3.fromRGB(20,20,60)   end })
Tabs.World:AddButton({ Title = "Clima: Pôr do Sol",    Callback = function() Lighting.ClockTime=18;  Lighting.Brightness=1.5; Lighting.FogEnd=800;  Lighting.Ambient=Color3.fromRGB(255,140,60) end })
Tabs.World:AddButton({ Title = "Clima: Névoa Densa",   Callback = function() Lighting.ClockTime=10;  Lighting.Brightness=1;   Lighting.FogEnd=80;   Lighting.FogColor=Color3.fromRGB(180,180,180) end })

Tabs.World:AddButton({
    Title = "Resetar Mundo",
    Callback = function()
        workspace.Gravity  = 196.2
        Options.Gravity:SetValue(196)
        for k,v in pairs(ORIG) do Lighting[k] = v end
        notify("Reset", "Mundo restaurado ao original.")
    end,
})

-- ──────────────────────────────────────────
--  ABA MISC
-- ──────────────────────────────────────────
Tabs.Misc:AddButton({
    Title = "Copiar Posição",
    Description = "Copia coordenadas do char para o clipboard",
    Callback = function()
        local root = getRoot(); if not root then return end
        local p = root.Position
        local str = ("Vector3.new(%.2f, %.2f, %.2f)"):format(p.X, p.Y, p.Z)
        setclipboard(str)
        notify("Copiado!", str, 5)
    end,
})

Tabs.Misc:AddButton({
    Title = "Info do Servidor",
    Callback = function()
        local info = ("Jogadores: %d/%d\nPlace ID: %d\nJob ID: %s"):format(
            #Players:GetPlayers(), Players.MaxPlayers,
            game.PlaceId, game.JobId:sub(1,16).."..."
        )
        notify("Info", info, 8)
    end,
})

Tabs.Misc:AddToggle("DeletePart", {
    Title = "Deletar Parte (clique)",
    Description = "Clique em objetos do mapa para remover (local)",
    Default = false,
    Callback = function(v)
        dconn("delpart")
        if not v then return end
        conn("delpart", UserInput.InputBegan, function(inp)
            if inp.UserInputType ~= Enum.UserInputType.MouseButton1 then return end
            if not (Options.DeletePart and Options.DeletePart.Value) then return end
            local target = LP:GetMouse().Target
            if target and not Players:GetPlayerFromCharacter(target.Parent) then
                target:Destroy()
                notify("Deletado", "Parte removida localmente.")
            end
        end)
    end,
})

-- ──────────────────────────────────────────
--  CONFIG
-- ──────────────────────────────────────────
SaveManager:SetLibrary(Fluent)
InterfaceManager:SetLibrary(Fluent)
SaveManager:IgnoreThemeSettings()
SaveManager:SetIgnoreIndexes({})
InterfaceManager:SetFolder("FluentHub")
SaveManager:SetFolder("FluentHub/BrookhavenV4")
InterfaceManager:BuildInterfaceSection(Tabs.Config)
SaveManager:BuildConfigSection(Tabs.Config)

Window:SelectTab(1)
SaveManager:LoadAutoloadConfig()

notify("Brookhaven Admin HD v4", "Aberto! RCtrl = minimizar\n"..#Players:GetPlayers().." jogadores online", 6)
